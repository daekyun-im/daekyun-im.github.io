---
layout: single
title: "2026 01 12 Train 2"
categories: coding
tag: ['python', 'jupyter']
toc: true
author_profile: false
---

# ✅ 문제 (2026-01-12_

## 1️⃣ 파싱



df에서 아래 컬럼을 갖는 df2를 만들어라.



| batch | temp | ph | glc |



조건:



batch는 문자열



temp, ph, glc는 float



원본 df 변경 ❌



## 2️⃣ KPI 계산



df2에서 batch 단위로 다음 KPI를 계산하여

df_kpi를 만들어라.



| batch | mean_glc | low_ph_ratio | stress_ratio |



정의:



mean_glc

→ batch별 glc 평균



low_ph_ratio

→ ph < 7.0 인 행 비율



stress_ratio

→ (ph < 7.0) & (temp < 37.0) 인 행 비율



## ⚠️ 조건



for / while ❌



Boolean 조건 + 평균 활용



## 3️⃣ 분석



stress_ratio가 가장 높은 batch를

문자열 변수 stress_batch에 저장하라.



mean_glc가 전체 평균보다 낮은 batch들을

Python list low_glc_batches에 저장하라.



## 4️⃣ 시각화 (조건 엄수)

Bar plot: batch별 mean_glc



figure size: (7, 4)



x축: batch (B1, B2, B3 순서 유지)



y축: mean_glc



bar color:



stress_batch → red



그 외 → gray



title: "Mean Glucose by Batch"



xlabel: "Batch"



ylabel: "Mean Glucose"



grid: 표시 ❌



legend: 표시 ❌



전체 mean_glc 평균 위치에



회색 점선 수평선 추가



linestyle "--"



linewidth 2



## ❗ 조건 요약



pandas + numpy + matplotlib만 사용



정규식 ❌



for / while ❌



문제에 없는 컬럼/시각 요소 추가 ❌



결과 변수명 정확히 맞출 것

(df2, df_kpi, stress_batch, low_glc_batches)

```python
import pandas as pd

df = pd.DataFrame({
    "log": [
        "batch=B1|temp=37.0|ph=7.10|glc=4.5",
        "batch=B1|temp=37.0|ph=6.95|glc=4.2",
        "batch=B1|temp=36.5|ph=7.05|glc=4.0",
        "batch=B2|temp=37.0|ph=7.25|glc=5.1",
        "batch=B2|temp=36.5|ph=6.85|glc=4.6",
        "batch=B2|temp=36.5|ph=6.90|glc=4.4",
        "batch=B3|temp=37.0|ph=6.80|glc=3.9",
        "batch=B3|temp=36.5|ph=6.75|glc=3.7",
        "batch=B3|temp=36.5|ph=6.70|glc=3.6",
    ]
})
display(df)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>log</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>batch=B1|temp=37.0|ph=7.10|glc=4.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>batch=B1|temp=37.0|ph=6.95|glc=4.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>batch=B1|temp=36.5|ph=7.05|glc=4.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>batch=B2|temp=37.0|ph=7.25|glc=5.1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>batch=B2|temp=36.5|ph=6.85|glc=4.6</td>
    </tr>
    <tr>
      <th>5</th>
      <td>batch=B2|temp=36.5|ph=6.90|glc=4.4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>batch=B3|temp=37.0|ph=6.80|glc=3.9</td>
    </tr>
    <tr>
      <th>7</th>
      <td>batch=B3|temp=36.5|ph=6.75|glc=3.7</td>
    </tr>
    <tr>
      <th>8</th>
      <td>batch=B3|temp=36.5|ph=6.70|glc=3.6</td>
    </tr>
  </tbody>
</table>
</div>

```python
tmp = df['log'].str.split("|", expand=True)
display(tmp)
df2 = tmp.apply(lambda x: x.str.split("=").str[1])
df2.columns = ['batch','temp','ph','glc']
df2[['temp','ph','glc']] = df2[['temp','ph','glc']].astype('float')
display(df2)
df_kpi = df2.groupby('batch').agg(
    mean_glc = ('glc', 'mean'),
    low_ph_ratio = ('ph', lambda x: (x < 7.0).mean()),
    stress_ratio = ("ph", lambda x: ((x < 7.0) & (df2.loc[x.index, "temp"] < 37.0)).mean())
).reset_index()
display(df_kpi)
stress_ratio = df_kpi.loc[df_kpi['stress_ratio'].idxmax()]['batch']
low_glc_batches = df_kpi[df_kpi['mean_glc']<df2['glc'].mean()]['batch'].to_list()
display(stress_ratio, low_glc_batches)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>batch=B1</td>
      <td>temp=37.0</td>
      <td>ph=7.10</td>
      <td>glc=4.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>batch=B1</td>
      <td>temp=37.0</td>
      <td>ph=6.95</td>
      <td>glc=4.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>batch=B1</td>
      <td>temp=36.5</td>
      <td>ph=7.05</td>
      <td>glc=4.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>batch=B2</td>
      <td>temp=37.0</td>
      <td>ph=7.25</td>
      <td>glc=5.1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>batch=B2</td>
      <td>temp=36.5</td>
      <td>ph=6.85</td>
      <td>glc=4.6</td>
    </tr>
    <tr>
      <th>5</th>
      <td>batch=B2</td>
      <td>temp=36.5</td>
      <td>ph=6.90</td>
      <td>glc=4.4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>batch=B3</td>
      <td>temp=37.0</td>
      <td>ph=6.80</td>
      <td>glc=3.9</td>
    </tr>
    <tr>
      <th>7</th>
      <td>batch=B3</td>
      <td>temp=36.5</td>
      <td>ph=6.75</td>
      <td>glc=3.7</td>
    </tr>
    <tr>
      <th>8</th>
      <td>batch=B3</td>
      <td>temp=36.5</td>
      <td>ph=6.70</td>
      <td>glc=3.6</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>batch</th>
      <th>temp</th>
      <th>ph</th>
      <th>glc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>B1</td>
      <td>37.0</td>
      <td>7.10</td>
      <td>4.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B1</td>
      <td>37.0</td>
      <td>6.95</td>
      <td>4.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B1</td>
      <td>36.5</td>
      <td>7.05</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B2</td>
      <td>37.0</td>
      <td>7.25</td>
      <td>5.1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B2</td>
      <td>36.5</td>
      <td>6.85</td>
      <td>4.6</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B2</td>
      <td>36.5</td>
      <td>6.90</td>
      <td>4.4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>B3</td>
      <td>37.0</td>
      <td>6.80</td>
      <td>3.9</td>
    </tr>
    <tr>
      <th>7</th>
      <td>B3</td>
      <td>36.5</td>
      <td>6.75</td>
      <td>3.7</td>
    </tr>
    <tr>
      <th>8</th>
      <td>B3</td>
      <td>36.5</td>
      <td>6.70</td>
      <td>3.6</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>batch</th>
      <th>mean_glc</th>
      <th>low_ph_ratio</th>
      <th>stress_ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>B1</td>
      <td>4.233333</td>
      <td>0.333333</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B2</td>
      <td>4.700000</td>
      <td>0.666667</td>
      <td>0.666667</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B3</td>
      <td>3.733333</td>
      <td>1.000000</td>
      <td>0.666667</td>
    </tr>
  </tbody>
</table>
</div>

```
'B2'
```

```
['B3']
```

```python
import matplotlib.pyplot as plt
df_kpi_ordered = df_kpi.sort_values(by='batch', ascending=True)
fig, ax = plt.subplots(figsize=(7,4))
import numpy as np
color = np.where(df_kpi_ordered['batch']==stress_batch, 'red', 'gray')
ax.bar(df_kpi_ordered['batch'], df_kpi_ordered['mean_glc'], color = color)
ax.set_title("Mean Glucose by Batch")
ax.set_xlabel("Batch")
ax.set_ylabel("Mean Glucose")
ax.grid(False)
ax.axhline(df2[g])
```
