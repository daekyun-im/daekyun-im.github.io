---
layout: single
title: "2026 01 25 Train 1"
categories: coding
tag: ['python', 'jupyter']
toc: true
author_profile: false
---

# âœ… ë¬¸ì œ (2026-01-25)

## 1ï¸âƒ£ ì¡°ê±´ë¶€ ë³‘í•© + í•„í„°ë§ (í•µì‹¬ ìœ í˜•)



df_measì™€ df_settingì„ run ê¸°ì¤€ìœ¼ë¡œ left merge í•˜ì—¬ df_mergedë¥¼ ë§Œë“¤ì–´ë¼.



ê·¸ ë‹¤ìŒ ì•„ëž˜ ì¡°ê±´ì„ ì ìš©í•œ ìœ íš¨ ì¸¡ì •ë§Œ ë‚¨ê²¨ë¼.



target_dayê°€ ì¡´ìž¬í•˜ë©´

â†’ day == target_day ì¸ í–‰ë§Œ ìœ ì§€



target_dayê°€ NaNì´ë©´

â†’ í•´ë‹¹ runì˜ ê°€ìž¥ í° day í–‰ë§Œ ìœ ì§€



### âš ï¸ ì¡°ê±´



for / while âŒ



apply âŒ



groupby + transform / ì •ë ¬ ì‚¬ìš© ê°€ëŠ¥



## 2ï¸âƒ£ ê°€ì¤‘ ì„±ê³¼ ì ìˆ˜ ê³„ì‚°



í•„í„°ë§ëœ ê²°ê³¼ë¥¼ run ë‹¨ìœ„ë¡œ **1í–‰ë§Œ ë‚¨ê¸´ df_final**ì„ ë§Œë“¤ì–´ë¼.



ì•„ëž˜ ì»¬ëŸ¼ì„ ê³„ì‚°í•˜ë¼.



ì •ì˜



raw_score = titer * viability



weighted_score = raw_score * importance



### âš ï¸ importanceëŠ” ë°˜ë“œì‹œ df_settingì—ì„œ mergeëœ ê°’ ì‚¬ìš©



## 3ï¸âƒ£ Rule ê¸°ë°˜ í‰ê°€



ì•„ëž˜ ê¸°ì¤€ìœ¼ë¡œ **ì„±ê³¼ ë“±ê¸‰ ì»¬ëŸ¼ grade**ë¥¼ ë§Œë“¤ì–´ë¼.



weighted_score >= 350 â†’ "A"



250 <= weighted_score < 350 â†’ "B"



ê·¸ ì™¸ â†’ "C"



## 4ï¸âƒ£ ë¦¬í¬íŠ¸ í…Œì´ë¸” ìƒì„±



df_finalì„ ì•„ëž˜ ì»¬ëŸ¼/ìˆœì„œë¡œ ì •ë¦¬í•˜ë¼.



| run | day | titer | viability | importance | weighted_score | grade |



ì •ë ¬:



weighted_score ë‚´ë¦¼ì°¨ìˆœ



### â— ì œì¶œë¬¼



df_merged



df_final



(print/display ìžìœ )



## ðŸ§  ì´ ë¬¸ì œì—ì„œ ë³´ëŠ” â€œìƒˆ ìœ í˜•â€ í¬ì¸íŠ¸



ì¡°ê±´ë¶€ í•„í„°ë§ merge ê²°ê³¼ ì²˜ë¦¬



ê²°ì¸¡(NaN)ì— ë”°ë¼ ë‹¤ë¥¸ í–‰ ì„ íƒ ë¡œì§



ê°€ì¤‘ì¹˜ ê¸°ë°˜ score ê³„ì‚°



ë‹¨ìˆœí•˜ì§€ë§Œ ì‹¤ë¬´ì ì¸ grading rule

# ë°ì´í„°

```python
import pandas as pd
import numpy as np

df_meas = pd.DataFrame({
    "run": ["R1","R1","R1","R2","R2","R2","R3","R3","R3","R4","R4","R4"],
    "day":  [1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3],
    "viability": [98, 97, 96, 95, 93, 90, 92, 88, 85, 99, 99, 99],
    "titer":     [1.8, 2.0, 2.2, 1.5, 1.6, 1.7, 1.2, 1.3, 1.4, 2.5, 2.5, 2.5],
})
df_setting = pd.DataFrame({
    "run": ["R1","R2","R3","R4"],
    "target_day": [3, 3, np.nan, 3],
    "importance": [1.0, 1.2, 0.8, 1.5],
})
display(df_meas, df_setting)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>run</th>
      <th>day</th>
      <th>viability</th>
      <th>titer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R1</td>
      <td>1</td>
      <td>98</td>
      <td>1.8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R1</td>
      <td>2</td>
      <td>97</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R1</td>
      <td>3</td>
      <td>96</td>
      <td>2.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R2</td>
      <td>1</td>
      <td>95</td>
      <td>1.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>2</td>
      <td>93</td>
      <td>1.6</td>
    </tr>
    <tr>
      <th>5</th>
      <td>R2</td>
      <td>3</td>
      <td>90</td>
      <td>1.7</td>
    </tr>
    <tr>
      <th>6</th>
      <td>R3</td>
      <td>1</td>
      <td>92</td>
      <td>1.2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>R3</td>
      <td>2</td>
      <td>88</td>
      <td>1.3</td>
    </tr>
    <tr>
      <th>8</th>
      <td>R3</td>
      <td>3</td>
      <td>85</td>
      <td>1.4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>R4</td>
      <td>1</td>
      <td>99</td>
      <td>2.5</td>
    </tr>
    <tr>
      <th>10</th>
      <td>R4</td>
      <td>2</td>
      <td>99</td>
      <td>2.5</td>
    </tr>
    <tr>
      <th>11</th>
      <td>R4</td>
      <td>3</td>
      <td>99</td>
      <td>2.5</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>run</th>
      <th>target_day</th>
      <th>importance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R1</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R2</td>
      <td>3.0</td>
      <td>1.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R3</td>
      <td>NaN</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R4</td>
      <td>3.0</td>
      <td>1.5</td>
    </tr>
  </tbody>
</table>
</div>

```python
df_merged = df_meas.merge(df_setting, how='left', on='run')
display(df_merged)
import numpy as np
df_merged['max_day']=df_merged.groupby('run').day.transform('max')
filtered = np.where(df_merged['target_day'].notna(), df_merged['target_day']==df_merged['day'], df_merged['day']==df_merged['max_day'])
df_final = df_merged[filtered].copy()
display(df_final)
df_final['raw_score'] = df_final['titer']*df_final['viability']
df_final['weighted_score'] = df_final['raw_score']*df_final['importance']
display(df_final)
df_final['grade'] = np.where(df_final['weighted_score']>=350, "A", (np.where(df_final['weighted_score']>=250, "B", "C")))
display(df_final)
df_final = df_final[['run','day','titer','viability','importance','weighted_score','grade']].sort_values(by='weighted_score', ascending=False).reset_index(drop=True)
display(df_final)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>run</th>
      <th>day</th>
      <th>viability</th>
      <th>titer</th>
      <th>target_day</th>
      <th>importance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R1</td>
      <td>1</td>
      <td>98</td>
      <td>1.8</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R1</td>
      <td>2</td>
      <td>97</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R1</td>
      <td>3</td>
      <td>96</td>
      <td>2.2</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R2</td>
      <td>1</td>
      <td>95</td>
      <td>1.5</td>
      <td>3.0</td>
      <td>1.2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R2</td>
      <td>2</td>
      <td>93</td>
      <td>1.6</td>
      <td>3.0</td>
      <td>1.2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>R2</td>
      <td>3</td>
      <td>90</td>
      <td>1.7</td>
      <td>3.0</td>
      <td>1.2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>R3</td>
      <td>1</td>
      <td>92</td>
      <td>1.2</td>
      <td>NaN</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>R3</td>
      <td>2</td>
      <td>88</td>
      <td>1.3</td>
      <td>NaN</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>8</th>
      <td>R3</td>
      <td>3</td>
      <td>85</td>
      <td>1.4</td>
      <td>NaN</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>9</th>
      <td>R4</td>
      <td>1</td>
      <td>99</td>
      <td>2.5</td>
      <td>3.0</td>
      <td>1.5</td>
    </tr>
    <tr>
      <th>10</th>
      <td>R4</td>
      <td>2</td>
      <td>99</td>
      <td>2.5</td>
      <td>3.0</td>
      <td>1.5</td>
    </tr>
    <tr>
      <th>11</th>
      <td>R4</td>
      <td>3</td>
      <td>99</td>
      <td>2.5</td>
      <td>3.0</td>
      <td>1.5</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>run</th>
      <th>day</th>
      <th>viability</th>
      <th>titer</th>
      <th>target_day</th>
      <th>importance</th>
      <th>max_day</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>R1</td>
      <td>3</td>
      <td>96</td>
      <td>2.2</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>R2</td>
      <td>3</td>
      <td>90</td>
      <td>1.7</td>
      <td>3.0</td>
      <td>1.2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>8</th>
      <td>R3</td>
      <td>3</td>
      <td>85</td>
      <td>1.4</td>
      <td>NaN</td>
      <td>0.8</td>
      <td>3</td>
    </tr>
    <tr>
      <th>11</th>
      <td>R4</td>
      <td>3</td>
      <td>99</td>
      <td>2.5</td>
      <td>3.0</td>
      <td>1.5</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>

```
C:\Users\Admin\AppData\Local\Temp\ipykernel_2204\622250154.py:8: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final['raw_score'] = df_final['titer']*df_final['viability']
C:\Users\Admin\AppData\Local\Temp\ipykernel_2204\622250154.py:9: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final['weighted_score'] = df_final['raw_score']*df_final['importance']
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>run</th>
      <th>day</th>
      <th>viability</th>
      <th>titer</th>
      <th>target_day</th>
      <th>importance</th>
      <th>max_day</th>
      <th>raw_score</th>
      <th>weighted_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>R1</td>
      <td>3</td>
      <td>96</td>
      <td>2.2</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3</td>
      <td>211.2</td>
      <td>211.20</td>
    </tr>
    <tr>
      <th>5</th>
      <td>R2</td>
      <td>3</td>
      <td>90</td>
      <td>1.7</td>
      <td>3.0</td>
      <td>1.2</td>
      <td>3</td>
      <td>153.0</td>
      <td>183.60</td>
    </tr>
    <tr>
      <th>8</th>
      <td>R3</td>
      <td>3</td>
      <td>85</td>
      <td>1.4</td>
      <td>NaN</td>
      <td>0.8</td>
      <td>3</td>
      <td>119.0</td>
      <td>95.20</td>
    </tr>
    <tr>
      <th>11</th>
      <td>R4</td>
      <td>3</td>
      <td>99</td>
      <td>2.5</td>
      <td>3.0</td>
      <td>1.5</td>
      <td>3</td>
      <td>247.5</td>
      <td>371.25</td>
    </tr>
  </tbody>
</table>
</div>

```
C:\Users\Admin\AppData\Local\Temp\ipykernel_2204\622250154.py:11: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final['grade'] = np.where(df_final['weighted_score']>=350, "A", (np.where(df_final['weighted_score']>=250, "B", "C")))
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>run</th>
      <th>day</th>
      <th>viability</th>
      <th>titer</th>
      <th>target_day</th>
      <th>importance</th>
      <th>max_day</th>
      <th>raw_score</th>
      <th>weighted_score</th>
      <th>grade</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>R1</td>
      <td>3</td>
      <td>96</td>
      <td>2.2</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3</td>
      <td>211.2</td>
      <td>211.20</td>
      <td>C</td>
    </tr>
    <tr>
      <th>5</th>
      <td>R2</td>
      <td>3</td>
      <td>90</td>
      <td>1.7</td>
      <td>3.0</td>
      <td>1.2</td>
      <td>3</td>
      <td>153.0</td>
      <td>183.60</td>
      <td>C</td>
    </tr>
    <tr>
      <th>8</th>
      <td>R3</td>
      <td>3</td>
      <td>85</td>
      <td>1.4</td>
      <td>NaN</td>
      <td>0.8</td>
      <td>3</td>
      <td>119.0</td>
      <td>95.20</td>
      <td>C</td>
    </tr>
    <tr>
      <th>11</th>
      <td>R4</td>
      <td>3</td>
      <td>99</td>
      <td>2.5</td>
      <td>3.0</td>
      <td>1.5</td>
      <td>3</td>
      <td>247.5</td>
      <td>371.25</td>
      <td>A</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>run</th>
      <th>day</th>
      <th>titer</th>
      <th>viability</th>
      <th>importance</th>
      <th>weighted_score</th>
      <th>grade</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>11</td>
      <td>R4</td>
      <td>3</td>
      <td>2.5</td>
      <td>99</td>
      <td>1.5</td>
      <td>371.25</td>
      <td>A</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>R1</td>
      <td>3</td>
      <td>2.2</td>
      <td>96</td>
      <td>1.0</td>
      <td>211.20</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5</td>
      <td>R2</td>
      <td>3</td>
      <td>1.7</td>
      <td>90</td>
      <td>1.2</td>
      <td>183.60</td>
      <td>C</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8</td>
      <td>R3</td>
      <td>3</td>
      <td>1.4</td>
      <td>85</td>
      <td>0.8</td>
      <td>95.20</td>
      <td>C</td>
    </tr>
  </tbody>
</table>
</div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>run</th>
      <th>day</th>
      <th>viability</th>
      <th>titer</th>
      <th>target_day</th>
      <th>importance</th>
      <th>max_day</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>R1</td>
      <td>3</td>
      <td>96</td>
      <td>2.2</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>R2</td>
      <td>3</td>
      <td>90</td>
      <td>1.7</td>
      <td>3.0</td>
      <td>1.2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>8</th>
      <td>R3</td>
      <td>3</td>
      <td>85</td>
      <td>1.4</td>
      <td>NaN</td>
      <td>0.8</td>
      <td>3</td>
    </tr>
    <tr>
      <th>11</th>
      <td>R4</td>
      <td>3</td>
      <td>99</td>
      <td>2.5</td>
      <td>3.0</td>
      <td>1.5</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
